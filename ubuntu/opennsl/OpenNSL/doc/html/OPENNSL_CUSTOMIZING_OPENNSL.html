<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>OpenNSL API Guide and Reference Manual: Customizing OpenNSL Platform</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen_brcm.css" rel="stylesheet" type="text/css" />
<link href="tabs_brcm.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">OpenNSL API Guide and Reference Manual
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.2 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Welcome</span></a></li>
      <li class="current"><a href="pages.html"><span>OpenNSL&#160;Documentation</span></a></li>
      <li><a href="modules.html"><span>API&#160;Reference</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Customizing OpenNSL Platform </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="OPENNSL_CUSTOMIZATION_OVERVIEW"></a>
Overview</h1>
<p>OpenNSL provides a mechanism to customize the switch initialization, by accepting a set of properties through a configuration file. The properties are mainly used to customize the platform without having to re-compile the OpenNSL.</p>
<h1><a class="anchor" id="OPENNSL_PLATFORM_CUSTOMIZATION"></a>
Platform customization</h1>
<p>OpenNSL is enhanced to accept the platform configuration from a file. During initialization, OpenNSL checks for the presence of configuration file. If the file exists, the configuration from the file is applied. Note that OpenNSL does not validate the property values specified in the file. For properties with invalid values, the default value would be assumed. Run-time modifications to the configuration file do not take effect until OpenNSL is re-initialized.</p>
<p>The configuration file is retrieved in the following order: </p>
<ul>
<li>The config file is specified via environment variable OPENNSL_CONFIG_FILE. This option is given the highest precedence so that configuration files can be changed without recompiling code.</li>
</ul>
<pre>
     # export OPENNSL_CONFIG_FILE=/home/admin/opennsl.cfg
</pre><ul>
<li>The config file is specified as an input parameter to the <a class="el" href="driver_8h.html#a06a6fe41f5ea8664c461423d3cad0923" title="Function to initialize the switch.">opennsl_driver_init()</a> function. rv = opennsl_driver_init(params);</li>
</ul>
<ul>
<li>The location '/etc/opennsl' is checked for presence of 'opennsl.cfg' file.</li>
</ul>
<ul>
<li>If the config file is not specified or does not exist, OpenNSL applies the default configuration for the given platform.</li>
</ul>
<p>End users can potentially use different configuration files based on the platform variant.</p>
<h1><a class="anchor" id="OPENNSL_CONFIG_PROPERTIES"></a>
Config properties</h1>
<p>A property is a 'name=value' pair where name is a string and value is typically specified as a number. Each property has a default value that is compiled into the driver and takes effect if the property is not customized. The following properties are allowed.</p>
<table  border="1">
<tr>
<th align="left"><b>Property</b>  </th><th align="left"><p class="starttd"><b>Description</b>  </p>
<p class="endtd"></p>
</th></tr>
<tr>
<td>portmap_&lt;port&gt;= &lt;pnum&gt;:&lt;bandwidth&gt; </td><td><p class="starttd">Specify Port numbering and bandwidth assignment <br/>
 port - Logical port number <br/>
 pnum - Physical port number <br/>
 bandwidth - Port bandwidth in Gb. <br/>
 Example: To map logical port 1 to physical port 29 and set the bandwidth to 40Gig, use "portmap_1=29:40"  </p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>phy_xaui_tx_polarity_flip_&lt;port&gt;=&lt;val&gt; </td><td><p class="starttd">Flip XAUI lane TX polarity on applicable serdes devices. <br/>
 Possible values for &lt;val&gt; are: <br/>
 1 - Flip TX polarity on all lane(s) of the port <br/>
 0x000F - Flip TX polarity on lane 0. <br/>
 0x00F0 - Flip TX polarity on lane 1. <br/>
 0x0F00 - Flip TX polarity on lane 2. <br/>
 0xF000 - Flip TX polarity on lane 3. <br/>
 Example: To set XAUI TX lane polarity settings for port 3 to a value of 0xe, use "phy_xaui_tx_polarity_flip_3=0xe"  </p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>phy_xaui_rx_polarity_flip_&lt;port&gt;=&lt;val&gt; </td><td><p class="starttd">Flip XAUI lane RX polarity. See phy_xaui_tx_polarity_flip for values. <br/>
 Example: To set XAUI RX lane polarity settings for port 4 to a value of 0xe, use "phy_xaui_rx_polarity_flip_4=0xe"  </p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>l2_mem_entries=&lt;val&gt; </td><td><p class="starttd">Specify number of widest L2 memory entries. <br/>
 Example: To set number of L2 entries to 32768, use "l2_mem_entries=32768"  </p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>l3_mem_entries=&lt;val&gt; </td><td><p class="starttd">Specify number of widest L3 memory entries. <br/>
 Example: To set number of L3 entries to 16384, use "l3_mem_entries=16384"  </p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>serdes_driver_current_lane&lt;lnum&gt;_&lt;port&gt;=&lt;val&gt; </td><td><p class="starttd">Serdes core driver current. Valid range: 8 bit. <br/>
 Example: To set the driver current for port 1, lane 3 to a value of 0x6, use "serdes_driver_current_lane3_1=0x6"  </p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>serdes_preemphasis_lane&lt;lnum&gt;_&lt;port&gt;=&lt;val&gt; </td><td><p class="starttd">Serdes core preemphasis. Valid range: 16 bit. <br/>
 Example: To set the pre-emphasis setting for port 1, lane 2 to a value of 0xc6e0, use "serdes_preemphasis_lane2_1=0xc6e0"  </p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>serdes_pre_driver_current_lane&lt;lnum&gt;_&lt;port&gt;=&lt;val&gt; </td><td><p class="starttd">Serdes core pre-driver current. Valid range: 8 bit. <br/>
 Example: To set the pre-driver current for port 1, lane 0 to a value of 0x4, use "serdes_pre_driver_current_lane0_1=0x4"  </p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>stable_filename=&lt;filename&gt; </td><td><p class="starttd">Specify the stable file to which the stable cache data (warmboot data) is written during warmboot operations.  To use this propery, "stable_location" has to be set to 2. <br/>
 Example: To use "/tmp/scache_file" for scache data, use "stable_filename=/tmp/scache_file"  </p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>stable_location=&lt;val&gt; </td><td><p class="starttd">Specify the stable cache option for Warm Boot operations. Please choose a value of 3 in order to use "stable_filename" property. <br/>
 Example: stable_location=3  </p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>stable_size=&lt;val&gt; </td><td><p class="starttd">Specify the stable cache size in bytes used for Warm boot operations. It depends on the features provided by the underlying silicon. Please choose the stable cache size appropriately. <br/>
 Example: Stable cache size of atleast 85MB is recommended for platforms with Tomahawk silicon, which can be set by using "stable_size=89128960".  </p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>scache_filename=&lt;filename&gt; </td><td><p class="starttd">Specify the file to which the warmboot cache data is written during warmboot operations. This is used to use the SDK system defaults for stable location and size, when stable_filename and stable_location are not specified explicitly. <br/>
 Example: To use "/tmp/scache_file" for scache data, use "scache_filename=/tmp/scache_file"  </p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>xgxs_rx_lane_map_&lt;port&gt;=&lt;val&gt; </td><td><p class="starttd">Remap XGXS RX lanes to desired mapping. Four bits were used for specifying each lane in the format of Lane 0 (bit 15-12), Lane 1 (bit 11-8), lane 2 (bit 7-4), and lane 3 (bit 3-0). For example, to reverse the rx lane mapping in 3, 2, 1, 0 order, set xgxs_rx_lane_map=0x3210. However for Warpcore serdes device, the format is in reversed order, that is, Lane 3 (bit 15-12), Lane 2 (bit 11-8),lane 1 (bit 7-4), and lane 0 (bit 3-0). The example above will be: xgxs_rx_lane_map=0x0123. <br/>
 Example: To set RX lane map for port 1 to a value of 0x213, use "xgxs_rx_lane_map_1=0x213"  </p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>xgxs_tx_lane_map_&lt;port&gt;=&lt;val&gt; </td><td><p class="starttd">Remap XGXS TX lanes to desired mapping. See xgxs_rx_lane_map for values. <br/>
 Example: To set TX lane map for port 29 to a value of 0x3021, use "xgxs_tx_lane_map_29=0x3021"  </p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>pbmp_xport_xe=&lt;pbmp&gt; </td><td><p class="starttd">Select the XE ports by specifying the port bitmap.<br/>
 Example: To have 72 XE ports on a platform, use "pbmp_xport_xe=0x1fffffffffffffffffe"  </p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>pbmp_oversubscribe=&lt;pbmp&gt; </td><td><p class="starttd">Port bitmap for ports in oversubscription mode.<br/>
 Example: To set oversubsciption mode for all 72 XE ports on a platform, use "pbmp_oversubscribe=0x1fffffffffffffffffe"  </p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>serdes_rx_los_&lt;port&gt;=&lt;val&gt; </td><td><p class="starttd">To control serdes Loss Of Signal(LOS) function. Possible values for &lt;val&gt; are: 0-disable, 1-enable.<br/>
 Example: To enable serdes LOS on port 29, use "serdes_rx_los_29=1"  </p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>rate_ext_mdio_divisor=&lt;val&gt; </td><td><p class="starttd">The frequency of the MDIO clock is a function of the core clock. This property is used to select external MDIO clock rate divisor.<br/>
 Example: rate_ext_mdio_divisor=0x80  </p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>bcm_num_cos=&lt;val&gt; </td><td><p class="starttd">Initial number of CoS queues the driver configures the switch for.<br/>
 Example: To set the number of COS queues to 8, use "bcm_num_cos=8"  </p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>bcm_stat_interval=&lt;val&gt; </td><td><p class="starttd">Set statistics collection interval in microseconds. Setting this to 0 will prevent counters from being started.<br/>
 Example: bcm_stat_interval=2000000  </p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>cdma_timeout_usec=&lt;val&gt; </td><td><p class="starttd">Counter DMA collection pass timeout in microseconds.<br/>
 Example: cdma_timeout_usec=3000000  </p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>tdma_timeout_usec=&lt;val&gt; </td><td><p class="starttd">Table DMA operation timeout in microseconds.<br/>
 Example: tdma_timeout_usec=3000000  </p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>phy_an_c37_&lt;port&gt;=&lt;val&gt; </td><td><p class="starttd">This controls the clause 37 auto-negotiation. <br/>
 Use value of 0 to disable and 3 to use clause 37 auto negotiation. <br/>
 Example: To set the C37 auto-negotiation on all xe ports, use "phy_an_c37_xe=3"  </p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>phy_an_c73_&lt;port&gt;=&lt;val&gt; </td><td><p class="starttd">This controls the clause 73 auto-negotiation. <br/>
 Use value of 0 to disable clause 73 auto negotiation. <br/>
 Example: To disable C73 auto-negotiation on all xe ports, use "phy_an_c73_xe=0"  </p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>miim_intr_enable=&lt;val&gt; </td><td><p class="starttd">This variable controls the interrupt mode for MII operations. <br/>
 Possible value for &lt;val&gt; are: <br/>
 1 - Use interrupts for MII operations <br/>
 0 - Use polling mode for MII operations <br/>
 Example: To use polling mode for MII operations, use "miim_intr_enable=0"  </p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>tdma_intr_enable=&lt;val&gt; </td><td><p class="starttd">This variable controls the interrupt mode for Table DMA operations. <br/>
 Possible value for &lt;val&gt; are: <br/>
 1 - Use interrupts for Table DMA operations <br/>
 0 - Use polling mode for Table DMA operations <br/>
 Example: tdma_intr_enable=0  </p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>schan_intr_enable=&lt;val&gt; </td><td><p class="starttd">This variable controls the interrupt mode for Address Resolution Logic (ARL) operations. <br/>
 Possible value for &lt;val&gt; are: <br/>
 1 - Use interrupts for ARL insert/delete operations <br/>
 0 - Use polling mode for all operations <br/>
 Example: schan_intr_enable=0  </p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>trunk_extend=&lt;val&gt; </td><td><p class="starttd">To extend maximum number of front panel trunk groups from 32 to 128. <br/>
 Example: trunk_extend=1  </p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>xgxs_lcpll_xtal_refclk=&lt;val&gt; </td><td><p class="starttd">To use crystal input for LCPLL. <br/>
 Example: xgxs_lcpll_xtal_refclk=1  </p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>module_64ports=&lt;val&gt; </td><td><p class="starttd">Device that can support more than 32 ports per single modid will operate in configuration where all ports are mapped to the base modid. <br/>
 Example: module_64ports=1  </p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>lpm_scaling_enable=&lt;val&gt; </td><td><p class="starttd">Possible values for &lt;val&gt; are: <br/>
 1: Allow adding 64B IPV6 LPM entries in unreserved paired TCAM. <br/>
 0: Do not allow adding 64B IPV6 LPM entries in paired TCAM. <br/>
 Example: lpm_scaling_enable=1  </p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>lpm_ipv6_128b_reserved=&lt;val&gt; </td><td><p class="starttd">Possible values for &lt;val&gt; are: <br/>
 1: Number of entries specified by num_ipv6_lpm_128b_entries property are reserved exclusively for 128B V6 LPM entries. <br/>
 0: Do not reserve any entries for 128B V6 entries and use the whole of paired TCAMs for either 128B V6, 64B V6, V4 entries. Ignored if lpm_scaling_enable is 0. <br/>
 Example: lpm_ipv6_128b_reserved=1  </p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>num_ipv6_lpm_128b_entries=&lt;val&gt; </td><td><p class="starttd">Configure the number of 128b prefix LPM routes. <br/>
 Example: num_ipv6_lpm_128b_entries=2000  </p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>ipv6_lpm_128b_enable=&lt;val&gt; </td><td><p class="starttd">1: Enable IPv6 128b prefix LPM routes. <br/>
 0: Disable IPv6 128b prefix LPM routes. <br/>
 Example: ipv6_lpm_128b_enable=1  </p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>l3_alpm_enable=&lt;val&gt; </td><td><p class="starttd">Enable ALPM for L3 Prefix routes. Set to 1 for parallel search mode, 2 for combined search mode. 3 for TCAM/ALPM mode. <br/>
 Example: l3_alpm_enable=2  </p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>max_vp_lags=&lt;val&gt; </td><td><p class="starttd">The maximum number of virtual port trunk groups. <br/>
 Example: max_vp_lags=0  </p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>serdes_firmware_mode=&lt;val&gt; </td><td><p class="starttd">To set Serdes micro controller firmware mode. <br/>
 Example: serdes_firmware_mode=2  </p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>serdes_if_type=&lt;val&gt; </td><td><p class="starttd">To manually select the port interface type like SFI, XFI, GMII, SGMII, XAUI, XLAUI. <br/>
 Use the values defined in _shr_port_if_t for &lt;val&gt;. <br/>
 Example: serdes_if_type=10 for XFI interface type.  </p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>skip_L2_USER_ENTRY=&lt;val&gt; </td><td><p class="starttd">To control sending of some reserved multicast MAC addresses to the CPU as PDU's. <br/>
 Possible value for &lt;val&gt; are: <br/>
 1 - To enable L2 caching of BPDU MAC addresses. <br/>
 0 - To disable L2 caching of BPDU MAC addresses. <br/>
 Example: skip_L2_USER_ENTRY=0  </p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>port_init_cl72=&lt;val&gt; </td><td><p class="starttd">Possible value for &lt;val&gt; are: <br/>
 1 - To initialize the port with CL72 enabled. <br/>
 0 - To initialize the port with CL72 diabled. <br/>
 Example: port_init_cl72=0  </p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>mmu_lossless=&lt;val&gt; </td><td><p class="starttd">To set the default MMU lossless behaviour.<br/>
 Possible value for &lt;val&gt; are: <br/>
 0 - For lossy application. Addressing fairness between queues. <br/>
 1 - For lossless application. Addressing avoiding packet loss, pause generation. <br/>
 Example: mmu_lossless=1  </p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>l2xmsg_hostbuf_size=&lt;val&gt; </td><td><p class="starttd">Size of the buffer that is used to drain L2 FIFO when working in the L2 FIFO mode. <br/>
 Example: l2xmsg_hostbuf_size=16384  </p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>l2xmsg_mode=&lt;val&gt; </td><td><p class="starttd">Mode control to select L2 Table DMA mode for L2 table change notifications. 0 - Polled, 1 - FIFO mode. <br/>
 Example: l2xmsg_mode=1  </p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>lls_num_l2uc=&lt;val&gt; </td><td><p class="starttd">The default number of unicast queues at L2 for Linked List Scheduler (LLS) setup. <br/>
 Example: lls_num_l2uc=16  </p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>tslam_intr_enable=&lt;val&gt; </td><td><p class="starttd">This variable controls the interrupt mode for Table SLAM DMA operations. <br/>
 Possible value for &lt;val&gt; are: <br/>
 1 - Use interrupts for Table SLAM DMA operations <br/>
 0 - Use polling mode for Table SLAM DMA operations <br/>
  </p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>tslam_timeout_usec=&lt;val&gt; </td><td><p class="starttd">Table SLAM DMA operation timeout in microseconds.<br/>
 Example: tslam_timeout_usec=3000000  </p>
<p class="endtd"></p>
</td></tr>
</table>
<p>Please refer to Hardware specification for more details on the parameters required for platform customization.</p>
<h1><a class="anchor" id="OPENNSL_CONFIG_EXAMPLE"></a>
Example configuration</h1>
<p>The following sample configuration is used to configure the first two ports in 40g mode. <br/>
 portmap_1=29:40 <br/>
 portmap_2=25:40 <br/>
</p>
<p>The following sample configuration is used to configure the same set of ports in 10g mode, with each 40g converting into four 10g ports. <br/>
 portmap_1=29:10 <br/>
 portmap_2=30:10 <br/>
 portmap_3=31:10 <br/>
 portmap_4=32:10 <br/>
 portmap_5=25:10 <br/>
 portmap_6=26:10 <br/>
 portmap_7=27:10 <br/>
 portmap_8=28:10 <br/>
</p>
<p>The following sample configuration is used for warmboot operations. <br/>
 stable_location=3 <br/>
 stable_filename=/tmp/scache_file <br/>
 stable_size=89128960 <br/>
 </p>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.5-->
<!-- start footer part -->
<!--BEGIN GENERATE_TREEVIEW -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
<hr>
<p>	
<table class="footer-brcm">
	<tr>
		<td class="footer-brcm"><img src="BRCM_Red+Black_noTag_RGB.png" align=left></td>
		<td class="footer-brcm"><small><b>&copy;  2016 by Broadcom Corporation. All rights reserved.</b></small>
			<div class="footer-brcm"><small>Broadcom Corporation reserves the right to make changes without further notice to any products or data herein to improve reliability, function, or design. 
Information furnished by Broadcom Corporation is believed to be accurate and reliable. However, Broadcom Corporation does not assume any liability arising 
out of the application or use of this information, nor the application or use of any product or circuit described herein, neither does it convey any license 
under its patent rights nor the rights of others. </small>
			</div>
		</td>
	</tr>
</table>	
</p>	
</div>
<!--END GENERATE_TREEVIEW-->
</body>
</html>
